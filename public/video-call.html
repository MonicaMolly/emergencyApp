<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emergency Video Call</title>
  <link rel="stylesheet" href="css/video-call.css" />
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.20.0.js"></script>
</head>
<body>

  <!-- Video container for local and remote video streams -->
  <div id="video-container">
    <!-- Local video stream -->
    <video id="local-video" autoplay muted playsinline></video>
    
    <!-- Remote video stream -->
    <video id="remote-video" autoplay playsinline></video>

    <!-- Controls for call -->
    <div class="controls">
      <!-- Start call button -->
      <button id="start-call-btn" onclick="startCall()">Start Call</button>
      <!-- End call button -->
      <button id="end-call-btn" onclick="endCall()">End Call</button>
    </div>
  </div>
  <script>
    fetch('/api/token')
    .then(res => res.json())
    .then(async ({ token, uid }) => {
      const client = AgoraRTC.createClient({ mode: 'rtc', codec: 'vp8' });

    await client.join(APP_ID, CHANNEL_NAME, token, uid);

    const localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
    const localVideoTrack = await AgoraRTC.createCameraVideoTrack();

    await client.publish([localAudioTrack, localVideoTrack]);

    console.log('Local stream published!');
  });
  </script>

  <!-- Link to video-call.js -->
  <script src="js/video-call.js"></script>
</body>
</html>
